{% extends 'QLBH/base.html' %}
{% load static %}

{% block title %}
    <title>Danh sách đơn hàng</title>
{% endblock %}

{% block headerlink %}

    <script type="text/javascript" src="{% static 'QLBH/js/doomEdit/jquery.doomEdit.js' %}"></script>
    <script type="text/javascript" src="{% static 'QLBH/js/doomEdit/jquery.doomEdit.adjust.js' %}"></script>
    <link href="{% static 'QLBH/css/doomEdit/doomEdit.css' %}" rel="stylesheet">
{% endblock %}

{% block nav_item_donhang %}active{% endblock %}

{% block subtitle %}
    <div class="h3 ml-2 mt-3 custom-text-title d-inline-flex">Danh sách đơn hàng</div>
{% endblock %}

{% block content %}

    <div class="container-fluid">
{#        <div class="d-inline-flex">#}

            <div class="card">
                <div class="card-header mb-0 pb-0 mt-0 pt-0">

                    <!-- START TABS DIV -->
                    <div class="tabbable-responsive">
                        <div class="tabbable">
                            <ul class="nav nav-tabs float-left mt-1" id="myTab" role="tablist">
                                <li class="nav-item">
                                    <a class="nav-link active nav-link-custom" id="all-tab" data-toggle="tab" href="#all" role="tab"
                                        aria-controls="all" aria-selected="true">Tất cả<span class="custom-tab-label ml-2 font-weight-lighter"></span></a>
                                </li>
                                {% for working in list_working %}
                                    <li class="nav-item">
                                        <a class="nav-link nav-link-custom" id="working-{{ working.Workingstatus_Id }}-tab" data-toggle="tab" href="#working-{{ working.Workingstatus_Id }}" role="tab"
                                            aria-controls="working-{{ working.Workingstatus_Id }}" aria-selected="false">{{ working.Workingstatus_Name }}<span class="custom-tab-label ml-2 font-weight-lighter"></span></a>
                                    </li>
                                {% endfor %}
                                <li class="nav-item">
                                    <a class="nav-link nav-link-custom" id="close_deadline-tab" data-toggle="tab" href="#close_deadline" role="tab"
                                        aria-controls="close_deadline" aria-selected="false">Deadline<span class="custom-tab-label ml-2 font-weight-lighter"></span></a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link nav-link-custom" id="notpayment-tab" data-toggle="tab" href="#notpayment" role="tab"
                                        aria-controls="notpayment" aria-selected="false">Chưa thanh toán<span class="custom-tab-label ml-2 font-weight-lighter"></span></a>
                                </li>


                            </ul>
                            <div class="m-0 mt-1 p-0 float-right">
                                   <form action="{% url 'QLBH:dsdonhang' %}" id="viewoption" name="FormOption" method="post">
                                       {% csrf_token %}
                                       <div class="">
                                           <select id="inputState" name="inputState" class="form-control form-control-custom" onchange="viewoption.submit()" required>
                                               {% if filteroption == 'thismonth' %}
                                                   <option value="thismonth" selected>Tháng này</option>
                                               {% else %}
                                                   <option value="thismonth">Tháng này</option>
                                               {% endif %}

                                               {% if filteroption == 'last30day' %}
                                                   <option value="last30day" selected>30 ngày gần nhất</option>
                                               {% else %}
                                                   <option value="last30day" >30 ngày gần nhất</option>
                                               {% endif %}

                                               {% if filteroption == 'all' %}
                                                   <option value="all" selected>Tất cả đơn</option>
                                               {% else %}
                                                   <option value="all">Tất cả đơn</option>
                                               {% endif %}
                                           </select>
                            {#                           <label>Loại logo</label>#}
                                       </div>
                                   </form>
                               </div>
                        </div>

                    </div>
                </div>
                <div class="card-body">
                    <div class="tab-content">
                        {% for key, values in list_donhang_final.items %}
                            {% if key == 'all' %}
                                <div class="tab-pane fade show active" id="{{ key }}" role="tabpanel" aria-labelledby="{{ key }}-tab">
                            {% else %}
                                <div class="tab-pane fade show" id="{{ key }}" role="tabpanel" aria-labelledby="{{ key }}-tab">
                            {% endif %}
                                <div class="table-responsive">
                                    <table class="table table-striped" id="dataTable-{{ key }}" width="100%" cellspacing="0" >
                                       <!--Table head-->
                                       <thead>
                                          <tr>

                                             <th class="col-sm-1">Mã đơn</th>
                                             <th class="col-sm-2">Tên logo</th>
                                             <th class="col-sm-1">Gói</th>
                                             <th class="col-sm-1">Deadline</th>
                                             <th class="col-sm-1">Tiến độ thực hiện</th>
                                             <th class="col-sm-1">Ngày tạo đơn</th>
                                             <th class="col-sm-1">Tên khách hàng</th>
                                             <th class="col-sm-1">Nguồn</th>
                                             <th class="col-sm-1">Tổng giá trị</th>
                                             <th class="col-sm-1">Đã thanh toán</th>
                                             <th class="col-sm-1">Chưa thanh toán</th>
                                          </tr>
                                       </thead>
                                       <!--Table head-->
                                       <!--Table body-->

                                        <tbody>
                                            {% for item in values %}

                                                {% if item.Workingstatus_Id == 1 %}
                                                    <tr style="background-color: #f4f4f4"> {# tiep nhan #}
                                                {% elif item.Workingstatus_Id == 2 %}
                                                    <tr style="background-color: #FEF2CD"> {# tien ky #}
                                                {% elif item.Workingstatus_Id == 3 %}
                                                    <tr style="background-color: #FFE1CC"> {# hau ky #}
                                                {% elif item.Workingstatus_Id == 4 %}
                                                    <tr style="background-color: #FFC599"> {#  gui khach duyet #}
                                                {% elif item.Workingstatus_Id == 5 %}
                                                    <tr style="background-color: #F7B4AE"> {# chinh sua #}
                                                {% elif item.Workingstatus_Id == 6 %}
                                                    <tr style="background-color: #B3CEFB"> {# anh bia #}
                                                {% elif item.Workingstatus_Id == 7 %}
                                                    <tr style="background-color: #B5E3E8"> {# in tem #}
                                                {% elif item.Workingstatus_Id == 8 %}
                                                    <tr style="background-color: #D1F1DA"> {# hoan thanh #}
                                                {% endif %}
                                                        <td><a href="{% url 'QLBH:donhang_detail' item.Donhang_Id %}">#{{ item.Donhang_Id }}</a><sup><a href="{% url 'QLBH:sua_don_hang' item.Donhang_Id %}"><img src="{% static 'QLBH\img\edit.png' %}" width="15px"></a></sup></td>
                                                        <td>{{ item.Donhang_Name }}</td>
                    {#                                    <td>{{ item.Donhang_Name }}</td>#}
                                                        <td>{{ item.Product_Name }}</td>
                                                        <td>{{ item.Deadline|date:"d-m-Y" }}</td>

{#                                                        <td>{{ item.Workingstatus_Name }}</td>#}
                                                        <td><span class="dedit-select" donhang_id="{{ item.Donhang_Id }}" post-type="deal__workingstatus">{{ item.Workingstatus_Name }}</span> <span class="doom-item-hide"><img src="{% static 'QLBH\img\pencil.png' %}" alt="" width="14"></span></td>
                                                        <td>{{ item.CreatedDate|date:"d-m-Y"}}</td>
                                                        <td><a href="#">{{ item.Customer_Name }}</a></td>
                                                        <td>{{ item.Source_Name }}</td>
                                                        <td class="text-right pr-2" post-type="deal__total">{{ item.Total |floatformat:"g"}}</td>
                                                        <td class="text-right pr-2"><span class="dedit-simple-blur" donhang_id="{{ item.Donhang_Id }}" post-type="deal__payment">{{ item.Donhang_Price_Payment|floatformat:"g"}}</span><span class="doom-item-hide"><img src="{% static 'QLBH\img\pencil.png' %}" width="14" alt=""></span></td>
{#                                                        <td class="text-right mr-sm-2">{{ item.Donhang_Price_Payment|floatformat:"g"}}</td>#}
                                                        <td class="text-right mr-sm-2">{{ item.Deft |floatformat:"g"}}</td>
                        {#                                        <td>{{ item.Note }}</td>#}
                                                    </tr>
                                            {% endfor %}
                                        </tbody>
                                       <!--Table body-->
                                    </table>
                                </div>
                            </div>
                        {% endfor %}

                    </div>
                </div>
            </div>

{#        </div>#}
{##}
{#       <!-- Page Heading -->#}
{##}
{##}
{#       <!-- DataTales Example -->#}
{#       <div class="card shadow mb-4">#}
{#          <!-- <div class="card-header py-3"> -->#}
{#          <!-- <h6 class="m-0 font-weight-bold text-primary">DataTables Example</h6> -->#}
{#          <!-- </div> -->#}
{#          <div class="card-body">#}
{#             <div class="table-responsive">#}
{#                     Add them data-order='' de chan auto sort khi load trang data-order = ''#}
{#                <table class="table table-striped" id="dataTable" width="100%" cellspacing="0" >#}
{#                   <!--Table head-->#}
{#                   <thead>#}
{#                      <tr>#}
{##}
{#                         <th class="col-sm-1">Mã đơn</th>#}
{#                         <th class="col-sm-2">Tên logo</th>#}
{#                         <th class="col-sm-1">Gói</th>#}
{#                         <th class="col-sm-1">Deadline</th>#}
{#                         <th class="col-sm-1">Tiến độ thực hiện</th>#}
{#                         <th class="col-sm-1">Ngày tạo đơn</th>#}
{#                         <th class="col-sm-1">Tên khách hàng</th>#}
{#                         <th class="col-sm-1">Số điện thoại</th>#}
{#                         <th class="col-sm-1">Tổng giá trị</th>#}
{#                         <th class="col-sm-1">Đã thanh toán</th>#}
{#                         <th class="col-sm-1">Chưa thanh toán</th>#}
{#                                 <th class="col-sm-1">Ghi chú</th>#}
{#                      </tr>#}
{#                   </thead>#}
{#                   <!--Table head-->#}
{#                   <!--Table body-->#}
{##}
{#                            a.Donhang_Id, a.Donhang_Name, case a.FlashDesign_Flag when 1 then 'Flash Design' else '' end Flash_Flag, a.Deadline, #}
{#                            d.Workingstatus_Name, a.CreatedDate, c.Customer_Name, c.Customer_Phone, a.Donhang_Price_Combo + a.Donhang_Price_Upsale - a.Donhang_Price_Discount as Total, #}
{#                            a.Donhang_Price_Payment, a.Donhang_Price_Combo + a.Donhang_Price_Upsale - a.Donhang_Price_Discount - a.Donhang_Price_Payment as Deft, '' as Note    #}
{#                    <tbody>#}
{#                        {% for item in list_donhang %}#}
{##}
{#                            {% if item.Workingstatus_Id == 1 %}#}
{#                                <tr style="background-color: #f4f4f4"> {# tiep nhan #}
{#                            {% elif item.Workingstatus_Id == 2 %}#}
{#                                <tr style="background-color: #FEF2CD"> {# tien ky #}
{#                            {% elif item.Workingstatus_Id == 3 %}#}
{#                                <tr style="background-color: #FFE1CC"> {# hau ky #}
{#                            {% elif item.Workingstatus_Id == 4 %}#}
{#                                <tr style="background-color: #FFC599"> {#  gui khach duyet #}
{#                            {% elif item.Workingstatus_Id == 5 %}#}
{#                                <tr style="background-color: #F7B4AE"> {# chinh sua #}
{#                            {% elif item.Workingstatus_Id == 6 %}#}
{#                                <tr style="background-color: #B3CEFB"> {# anh bia #}
{#                            {% elif item.Workingstatus_Id == 7 %}#}
{#                                <tr style="background-color: #B5E3E8"> {# in tem #}
{#                            {% elif item.Workingstatus_Id == 8 %}#}
{#                                <tr style="background-color: #D1F1DA"> {# hoan thanh #}
{#                            {% endif %}#}
{#                                    <td><a href="{% url 'QLBH:donhang_detail' item.Donhang_Id %}">#{{ item.Donhang_Id }}</a><sup><a href="{% url 'QLBH:sua_don_hang' item.Donhang_Id %}"><img src="{% static 'QLBH\img\edit.png' %}" width="15px"></a></sup></td>#}
{#                                    <td>{{ item.Donhang_Name }}</td>#}
{#                                    <td>{{ item.Donhang_Name }}</td>#}
{#                                    <td>{{ item.Product_Name }}</td>#}
{#                                    <td>{{ item.Deadline|date:"d-m-Y" }}</td>#}
{#                                    <td>{{ item.Workingstatus_Name }}</td>#}
{#                                    <td>{{ item.CreatedDate|date:"d-m-Y"}}</td>#}
{#                                    <td><a href="#">{{ item.Customer_Name }}</a></td>#}
{#                                    <td>{{ item.Customer_Phone }}</td>#}
{#                                    <td class="text-right pr-2">{{ item.Total |floatformat:"g"}}</td>#}
{#                                    <td class="text-right mr-sm-2">{{ item.Donhang_Price_Payment|floatformat:"g"}}</td>#}
{#                                    <td class="text-right mr-sm-2">{{ item.Deft |floatformat:"g"}}</td>#}
    {#                                        <td>{{ item.Note }}</td>#}
{#                                </tr>#}
{#                        {% endfor %}#}
{#                    </tbody>#}
{#                   <!--Table body-->#}
{#                </table>#}
{#             </div>#}
{#          </div>#}
{#       </div>#}
{##}
{#    </div>#}

{% endblock %}

{% block jsscript %}
    <script>
        let xlist = document.querySelectorAll("#myTab li a");
        for (let item of xlist) {
            let xdata = document.getElementById(item.getAttribute('aria-controls'));
            let table_length = xdata.querySelectorAll('tbody tr').length;
            if (table_length > 0) {
                item.querySelector('span').innerHTML = table_length
            }
        }

        $('#dataTable-all').dataTable({
           "order": [],
            "paging": false,
        });
	</script>
    <script type="text/javascript">
      let workingstatus_data = {
         {% for item in list_working %}
            "{{item.Workingstatus_Id}}": "{{item.Workingstatus_Name}}",
         {% endfor %}
      }
      let xpath_url = "{% url 'QLBH:ajax_update_db' %}"
      let csrf_token = "{{  csrf_token  }}"


   </script>


{% endblock %}
